<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.community.petish.hospital.mapper.ReviewMapper">
	<resultMap type="com.community.petish.hospital.domain.ReviewVO" id="reviewMap">
 		<result property="id" column="ID"/>
 		<result property="content" column="CONTENT"/>
 		<result property="score" column="SCORE"/>
 		<result property="create_date" column="CREATE_DATE"/>
 		<result property="deleted" column="DELETED"/>
 		<result property="user_id" column="USER_ID"/>
 		<result property="hospital_id" column="HOSPITAL_ID"/>
 		
 		
 	</resultMap>
 	
 	<select id="getHospitalReview" resultMap="reviewMap">
 		select * from hospital_review_tb_test where hospital_id =#{id} order by id desc
 	</select>
 	
 	<select id="getTotalCount" resultType="int">
 		select count(*) from hospital_review_tb_test where hospital_id =#{id}
 	</select>
 	
 	<select id="getReviewWithPaging" resultMap="reviewMap">
 		<![CDATA[
 			select *
			from
       			(
       			select rownum rn, id, content, score, user_id, hospital_id   
        		from
              		 (
              		 select
 							 id, content, score, user_id, hospital_id
 					 from
 							hospital_review_tb_test
 					 where hospital_id =#{hospital_id} order by id desc
 					 )
          		  where rownum<=#{pageNum}*#{amount}
       			 )
       		 where rn >(#{pageNum}-1)*#{amount}
 		]]>
 	</select>
 	
 	<insert id="insertReview" parameterType="com.community.petish.hospital.domain.ReviewVO">
 		<selectKey keyProperty="id" resultType="Long" order="BEFORE">
 			select reviewId_seq_test.nextval from dual
 		</selectKey>
 		insert into hospital_review_tb_test values(#{id},#{content},#{score},sysdate,0,#{user_id},#{hospital_id})
 	</insert>
</mapper>